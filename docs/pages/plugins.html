<!-- Plugin System Documentation - OVSM ONLY -->
<div class="page-header">
    <div class="command-line">
        <span class="prompt">user@osvm:~$</span>
        <span class="command typing">cat docs/plugins.md</span>
    </div>
</div>

<section class="page-intro">
    <h1>üß© Plugin System</h1>
    <p class="subtitle">Extend OSVM with OVSM scripts - custom commands, tools, and integrations</p>

    <div class="info-box" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; border: 2px solid #c23616; font-weight: bold;">
        ‚ö†Ô∏è <strong>OVSM-ONLY PLUGINS</strong> ‚ö†Ô∏è<br>
        All plugins are written in OVSM LISP. No Python, Rust, or JavaScript - just pure OVSM scripts (.ovsm files).
    </div>

    <div class="feature-highlights">
        <div class="highlight-item">
            <span class="highlight-icon">‚ö°</span>
            <span>OVSM Scripts</span>
        </div>
        <div class="highlight-item">
            <span class="highlight-icon">üîí</span>
            <span>Secure Sandboxing</span>
        </div>
        <div class="highlight-item">
            <span class="highlight-icon">üîó</span>
            <span>AI Integration</span>
        </div>
        <div class="highlight-item">
            <span class="highlight-icon">üì¶</span>
            <span>Easy Distribution</span>
        </div>
    </div>
</section>

<!-- Plugin Types Overview -->
<section class="plugin-types">
    <h2><span class="section-marker">[</span>PLUGIN TYPES<span class="section-marker">]</span></h2>

    <div class="plugin-type-grid">
        <div class="plugin-type-card" data-type="command">
            <div class="plugin-type-icon">‚å®Ô∏è</div>
            <h3>Command Plugins</h3>
            <p>Add custom slash commands using OVSM scripts</p>
            <div class="plugin-examples">
                <code>/weather Boston</code>
                <code>/analyze wallet</code>
                <code>/report daily</code>
            </div>
        </div>

        <div class="plugin-type-card" data-type="tool">
            <div class="plugin-type-icon">üîß</div>
            <h3>Tool Plugins</h3>
            <p>Provide MCP-style tools in OVSM for AI integration</p>
            <div class="plugin-examples">
                <code>AI: "Get wallet balance"</code>
                <code>‚Üí Uses OVSM tool automatically</code>
            </div>
        </div>

        <div class="plugin-type-card" data-type="automation">
            <div class="plugin-type-icon">ü§ñ</div>
            <h3>Automation Plugins</h3>
            <p>Schedule and automate blockchain tasks with OVSM</p>
            <div class="plugin-examples">
                <code>Monitor wallet activity</code>
                <code>Alert on large transfers</code>
            </div>
        </div>

        <div class="plugin-type-card" data-type="integration">
            <div class="plugin-type-icon">üîå</div>
            <h3>Integration Plugins</h3>
            <p>Connect to external APIs using OVSM's HTTP functions</p>
            <div class="plugin-examples">
                <code>/notify slack</code>
                <code>/export csv</code>
            </div>
        </div>
    </div>
</section>

<!-- Quick Start -->
<section class="quick-start">
    <h2><span class="section-marker">[</span>QUICK START<span class="section-marker">]</span></h2>

    <div class="quick-start-tabs">
        <button class="tab-btn active" onclick="showPluginTab('install')">Install Plugins</button>
        <button class="tab-btn" onclick="showPluginTab('create')">Create Plugin</button>
        <button class="tab-btn" onclick="showPluginTab('distribute')">Distribute</button>
    </div>

    <div class="tab-content active" id="plugin-install">
        <div class="code-block">
            <div class="code-header">Installing Plugins <span class="copy-hint">‚Üê Click any command to copy</span></div>
            <pre><code><span class="comment"># List available plugins</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins list')"><span class="prompt">$</span> osvm plugins list</span>

<span class="comment"># Install from local directory</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins install ./my-plugin/')"><span class="prompt">$</span> osvm plugins install ./my-plugin/</span>

<span class="comment"># Install from GitHub repository</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins install github.com/user/ovsm-plugin')"><span class="prompt">$</span> osvm plugins install github.com/user/ovsm-plugin</span>

<span class="comment"># Enable/disable plugins</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins enable wallet-monitor')"><span class="prompt">$</span> osvm plugins enable wallet-monitor</span>

<span class="comment"># Get plugin information</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins info wallet-monitor')"><span class="prompt">$</span> osvm plugins info wallet-monitor</span></code></pre>
        </div>
    </div>

    <div class="tab-content" id="plugin-create">
        <div class="code-block">
            <div class="code-header">Creating Your First OVSM Plugin <span class="copy-hint">‚Üê Click any command to copy</span></div>
            <pre><code><span class="comment"># Create plugin directory</span>
<span class="copyable-command" onclick="copyCommand('mkdir ~/.osvm/plugins/my-plugin')"><span class="prompt">$</span> mkdir ~/.osvm/plugins/my-plugin</span>
<span class="copyable-command" onclick="copyCommand('cd ~/.osvm/plugins/my-plugin')"><span class="prompt">$</span> cd ~/.osvm/plugins/my-plugin</span>

<span class="comment"># Create plugin manifest</span>
<span class="copyable-command" onclick="copyCommand('touch plugin.json')"><span class="prompt">$</span> touch plugin.json</span>

<span class="comment"># Create OVSM entry point script</span>
<span class="copyable-command" onclick="copyCommand('touch main.ovsm')"><span class="prompt">$</span> touch main.ovsm</span>

<span class="comment"># Test your plugin</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins install .')"><span class="prompt">$</span> osvm plugins install .</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins enable my-plugin')"><span class="prompt">$</span> osvm plugins enable my-plugin</span></code></pre>
        </div>
    </div>

    <div class="tab-content" id="plugin-distribute">
        <div class="code-block">
            <div class="code-header">Distributing OVSM Plugins <span class="copy-hint">‚Üê Click any command to copy</span></div>
            <pre><code><span class="comment"># Create GitHub repository</span>
<span class="copyable-command" onclick="copyCommand('git init && git add . && git commit -m \"Initial OVSM plugin\"')"><span class="prompt">$</span> git init && git add . && git commit -m "Initial OVSM plugin"</span>

<span class="comment"># Push to GitHub</span>
<span class="copyable-command" onclick="copyCommand('git remote add origin https://github.com/user/my-ovsm-plugin.git')"><span class="prompt">$</span> git remote add origin https://github.com/user/my-ovsm-plugin.git</span>
<span class="copyable-command" onclick="copyCommand('git push -u origin main')"><span class="prompt">$</span> git push -u origin main</span>

<span class="comment"># Others can now install with:</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins install github.com/user/my-ovsm-plugin')"><span class="prompt">$</span> osvm plugins install github.com/user/my-ovsm-plugin</span></code></pre>
        </div>
    </div>
</section>

<!-- Complete OVSM Plugin Example -->
<section id="command-plugins" class="plugin-detail-section">
    <h2><span class="section-marker">[</span>OVSM PLUGIN EXAMPLE<span class="section-marker">]</span></h2>

    <p>All plugins are written in OVSM LISP. Here's a complete wallet monitor plugin:</p>

    <div class="plugin-example">
        <h3>Wallet Monitor Plugin</h3>

        <div class="example-tabs">
            <button class="tab-btn active" onclick="showExampleTab('manifest')">plugin.json</button>
            <button class="tab-btn" onclick="showExampleTab('ovsm')">main.ovsm</button>
            <button class="tab-btn" onclick="showExampleTab('usage')">Usage</button>
        </div>

        <div class="tab-content active" id="example-manifest">
            <div class="code-block">
                <div class="code-header">Plugin Manifest (plugin.json)</div>
                <pre><code>{
  "name": "wallet-monitor",
  "version": "1.0.0",
  "description": "Monitor Solana wallet activity",
  "author": "Your Name",
  "license": "MIT",

  "plugin_type": "Command",
  "entry_point": "main.ovsm",
  "language": "ovsm",

  "commands": ["/monitor", "/alerts"],

  "permissions": [
    {"NetworkAccess": ["api.mainnet-beta.solana.com"]},
    "MCPAccess"
  ],

  "min_osvm_version": "0.9.0"
}</code></pre>
            </div>
        </div>

        <div class="tab-content" id="example-ovsm">
            <div class="code-block">
                <div class="code-header">OVSM Implementation (main.ovsm)</div>
                <pre><code>;; ============================================
;; Wallet Monitor Plugin - OVSM LISP
;; ============================================

;; Configuration
(define monitored-wallets [])
(define alert-threshold 1000000000)  ;; 1 SOL in lamports

;; Helper: Format lamports to SOL
(defun lamports-to-sol (lamports)
  (/ lamports 1000000000.0))

;; Helper: Check if transfer is large
(defun large-transfer? (amount)
  (> amount alert-threshold))

;; Get recent transactions for wallet
(defun get-recent-activity (wallet-addr)
  (define sigs (getSignaturesForAddress
    :address wallet-addr
    :limit 10))
  (map (lambda (sig)
    (getTransaction (. sig signature)))
    sigs))

;; Analyze wallet activity
(defun analyze-wallet (wallet-addr)
  (define txs (get-recent-activity wallet-addr))
  (define transfers
    (filter
      (lambda (tx)
        (and (not (null? tx))
             (= (get tx "type") "transfer")))
      txs))

  (define total-volume
    (reduce +
      (map (lambda (tx) (get tx "amount")) transfers)
      0))

  {
    :wallet wallet-addr
    :transaction_count (length txs)
    :transfer_count (length transfers)
    :total_volume (lamports-to-sol total-volume)
    :has_large_transfers (some large-transfer?
      (map (lambda (tx) (get tx "amount")) transfers))
  })

;; Command: /monitor <wallet>
(defun handle-monitor (args)
  (define wallet (first args))
  (if (null? wallet)
    (log :message "Usage: /monitor <wallet-address>")
    (do
      (log :message "Analyzing wallet..." :value wallet)
      (define analysis (analyze-wallet wallet))
      (log :message "=== Wallet Analysis ===" :value analysis)

      (when (. analysis has_large_transfers)
        (log :message "‚ö†Ô∏è ALERT: Large transfers detected!"))

      analysis)))

;; Command: /alerts
(defun handle-alerts (args)
  (define all-analyses
    (map analyze-wallet monitored-wallets))

  (define alerts
    (filter
      (lambda (a) (. a has_large_transfers))
      all-analyses))

  (if (empty? alerts)
    (log :message "‚úÖ No alerts - all wallets normal")
    (do
      (log :message "üö® Active Alerts:" :value (length alerts))
      (for (alert alerts)
        (log :message "  ‚ö†Ô∏è" :value (. alert wallet))))))

;; Main entry point - route commands
(defun main (context)
  (define command (get context "command"))
  (define args (get context "args"))

  (cond
    ((= command "/monitor") (handle-monitor args))
    ((= command "/alerts") (handle-alerts args))
    (true (log :message "Unknown command"))))</code></pre>
            </div>
        </div>

        <div class="tab-content" id="example-usage">
            <div class="code-block">
                <div class="code-header">Using the Wallet Monitor Plugin</div>
                <pre><code><span class="comment"># Install the plugin</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins install ./wallet-monitor')"><span class="prompt">$</span> osvm plugins install ./wallet-monitor</span>

<span class="comment"># Enable it</span>
<span class="copyable-command" onclick="copyCommand('osvm plugins enable wallet-monitor')"><span class="prompt">$</span> osvm plugins enable wallet-monitor</span>

<span class="comment"># Use in chat</span>
<span class="prompt">$</span> osvm chat
<span class="chat-user">> /monitor 9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM</span>
<span class="chat-bot">Analyzing wallet...
=== Wallet Analysis ===
{
  :wallet "9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM"
  :transaction_count 10
  :transfer_count 7
  :total_volume 156.42
  :has_large_transfers true
}
‚ö†Ô∏è ALERT: Large transfers detected!</span>

<span class="chat-user">> /alerts</span>
<span class="chat-bot">üö® Active Alerts: 1
  ‚ö†Ô∏è 9WzDXwBbmkg8ZTbNMqUxvQRAyrZzDsGYdLVL9zYtAWWM</span></code></pre>
            </div>
        </div>
    </div>
</section>

<!-- More OVSM Examples -->
<section class="more-examples">
    <h2><span class="section-marker">[</span>MORE OVSM PLUGIN EXAMPLES<span class="section-marker">]</span></h2>

    <div class="example-grid">
        <div class="example-card">
            <h3>üîî Notification Plugin</h3>
            <div class="code-block">
                <pre><code>;; Send alerts via webhook
(defun notify (message webhook-url)
  (http-post webhook-url
    {:text message
     :timestamp (now)}))

(defun handle-notify (args)
  (define msg (join " " args))
  (notify msg (get-config "webhook_url"))
  (log :message "Notification sent!"))</code></pre>
            </div>
        </div>

        <div class="example-card">
            <h3>üìä Portfolio Tracker</h3>
            <div class="code-block">
                <pre><code>;; Track token holdings
(defun get-portfolio (wallet)
  (define tokens (getTokenAccountsByOwner wallet))
  (map (lambda (token)
    {
      :mint (. token mint)
      :amount (. token amount)
      :decimals (. token decimals)
    })
    tokens))

(defun handle-portfolio (args)
  (define wallet (first args))
  (define holdings (get-portfolio wallet))
  (log :message "Portfolio:" :value holdings))</code></pre>
            </div>
        </div>

        <div class="example-card">
            <h3>üîç Transaction Analyzer</h3>
            <div class="code-block">
                <pre><code>;; Analyze transaction patterns
(defun analyze-tx (signature)
  (define tx (getTransaction signature))
  (define instructions (get tx "instructions"))

  {
    :program_calls (distinct
      (map (lambda (ix) (. ix programId))
        instructions))
    :fee (get tx "fee")
    :success (get tx "success")
  })

(defun handle-analyze (args)
  (define sig (first args))
  (log :message "Analysis:"
       :value (analyze-tx sig)))</code></pre>
            </div>
        </div>
    </div>
</section>

<!-- Security & Permissions -->
<section class="security-section">
    <h2><span class="section-marker">[</span>SECURITY & PERMISSIONS<span class="section-marker">]</span></h2>

    <div class="security-grid">
        <div class="security-feature">
            <h3>üîí OVSM Sandbox</h3>
            <p>All OVSM plugins run in a secure sandboxed interpreter</p>
        </div>
        <div class="security-feature">
            <h3>üìã Permission System</h3>
            <p>Plugins declare network and file access in plugin.json</p>
        </div>
        <div class="security-feature">
            <h3>üîç Code Review</h3>
            <p>OVSM code is human-readable and auditable</p>
        </div>
        <div class="security-feature">
            <h3>üõ°Ô∏è No Native Code</h3>
            <p>Pure OVSM - no compiled binaries, no system calls</p>
        </div>
    </div>

    <div class="permission-reference">
        <h3>Permission Types</h3>
        <div class="permission-list">
            <div class="permission-item">
                <code>NetworkAccess(["api.solana.com"])</code>
                <span>Allow RPC calls to specific hosts</span>
            </div>
            <div class="permission-item">
                <code>MCPAccess</code>
                <span>Access to MCP server tools</span>
            </div>
            <div class="permission-item">
                <code>ReadFiles(["~/.config/myapp"])</code>
                <span>Read local config files</span>
            </div>
            <div class="permission-item">
                <code>AIAccess</code>
                <span>Access to AI chat context</span>
            </div>
        </div>
    </div>
</section>

<!-- Plugin Marketplace -->
<section class="marketplace-section">
    <h2><span class="section-marker">[</span>COMMUNITY PLUGINS<span class="section-marker">]</span></h2>

    <div class="featured-plugins">
        <h3>Featured OVSM Plugins</h3>
        <div class="plugin-cards">
            <div class="plugin-card">
                <div class="plugin-icon">üëõ</div>
                <h4>Wallet Monitor</h4>
                <p>Real-time Solana wallet activity tracking in OVSM</p>
                <div class="plugin-meta">
                    <span class="plugin-author">@solanadev</span>
                    <span class="plugin-lang">OVSM</span>
                </div>
                <button class="install-btn" onclick="copyCommand('osvm plugins install github.com/solanadev/wallet-monitor')">Install</button>
            </div>

            <div class="plugin-card">
                <div class="plugin-icon">üìà</div>
                <h4>DEX Analytics</h4>
                <p>Analyze DEX trading patterns with OVSM scripts</p>
                <div class="plugin-meta">
                    <span class="plugin-author">@defitools</span>
                    <span class="plugin-lang">OVSM</span>
                </div>
                <button class="install-btn" onclick="copyCommand('osvm plugins install github.com/defitools/dex-analytics')">Install</button>
            </div>

            <div class="plugin-card">
                <div class="plugin-icon">üîî</div>
                <h4>Alert System</h4>
                <p>Configurable alerts for on-chain events</p>
                <div class="plugin-meta">
                    <span class="plugin-author">@chainwatch</span>
                    <span class="plugin-lang">OVSM</span>
                </div>
                <button class="install-btn" onclick="copyCommand('osvm plugins install github.com/chainwatch/alerts')">Install</button>
            </div>
        </div>
    </div>
</section>

<!-- Resources -->
<section class="resources-section">
    <h2><span class="section-marker">[</span>OVSM PLUGIN RESOURCES<span class="section-marker">]</span></h2>

    <div class="resource-grid">
        <div class="resource-item">
            <h3>üìñ Documentation</h3>
            <ul>
                <li><a href="#" data-cross-link="ovsm-language">OVSM Language Reference</a></li>
                <li><a href="#" data-cross-link="api-reference">Plugin API Reference</a></li>
                <li><a href="#" data-cross-link="mcp">MCP Integration Guide</a></li>
            </ul>
        </div>

        <div class="resource-item">
            <h3>üõ†Ô∏è Templates</h3>
            <ul>
                <li>Command Plugin Template (.ovsm)</li>
                <li>Tool Plugin Template (.ovsm)</li>
                <li>Automation Plugin Template (.ovsm)</li>
            </ul>
        </div>

        <div class="resource-item">
            <h3>ü§ù Community</h3>
            <ul>
                <li>Discord #ovsm-plugins Channel</li>
                <li>GitHub Discussions</li>
                <li>Plugin Showcase</li>
            </ul>
        </div>

        <div class="resource-item">
            <h3>üìö Learn OVSM</h3>
            <ul>
                <li><a href="#" data-cross-link="ovsm-language">OVSM Syntax Guide</a></li>
                <li><a href="#" data-cross-link="ovsm-language">Built-in Functions</a></li>
                <li><a href="#" data-cross-link="ovsm-language">Example Scripts</a></li>
            </ul>
        </div>
    </div>
</section>

<script>
// Plugin-specific JavaScript
function showPluginTab(tabName) {
    document.querySelectorAll('#plugin-install, #plugin-create, #plugin-distribute').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.quick-start-tabs .tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`plugin-${tabName}`).classList.add('active');
    event.target.classList.add('active');
}

function showExampleTab(tabName) {
    document.querySelectorAll('#example-manifest, #example-ovsm, #example-usage').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.parentElement.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.getElementById(`example-${tabName}`).classList.add('active');
    event.target.classList.add('active');
}
</script>

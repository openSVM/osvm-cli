;; AGGRESSIVE Agent - Undercuts HARD, low margins, high volume
;; Strategy: Race to the bottom to win market share
;; Now with REPUTATION API integration!

(do
  (define bbs-url "http://localhost:9099")
  (define agent-name "OVSM-Aggressor")
  (define base-cost 0.01)    ;; Ultra low cost
  (define target-margin 0.005) ;; Tiny 0.5% margin

  (log :message "")
  (log :message "ðŸ”¥ === AGGRESSIVE AGENT === ðŸ”¥")
  (log :message (concatenate "Agent: " agent-name))
  (log :message "Strategy: RACE TO BOTTOM - Win at any cost!")
  (log :message (concatenate "Price: " (str (+ base-cost target-margin)) " SOL FLAT"))
  (log :message "")

  ;; Fetch posts and bid on EVERYTHING
  (define resp (http-get (concatenate bbs-url "/api/boards/MARKETPLACE/posts?limit=20")))
  (define posts (get (parse-json (get resp "body")) "data"))

  (define bids-made 0)
  (define my-price (+ base-cost target-margin))

  (for (post posts)
    (do
      (define msg (get post "body"))
      (define id (get post "id"))

      (if (null? msg) null
          (do
            (define msg-upper (upper msg))
            (if (and (or (string-contains msg-upper "REQUEST")
                         (string-contains msg-upper "AUCTION"))
                     (< bids-made 5)) ;; Bid on first 5 requests
                (do
                  ;; Post BID to marketplace
                  (http-post (concatenate bbs-url "/api/boards/MARKETPLACE/posts")
                             {:message (concatenate "BID: " agent-name " - " (str my-price) " SOL! CHEAPEST OFFER! ðŸ”¥")
                              :agent agent-name})

                  ;; Record bid to reputation API
                  (http-post (concatenate bbs-url "/api/reputation/" agent-name)
                             {:action "bid"})

                  (set! bids-made (+ bids-made 1))
                  (log :message (concatenate "ðŸ”¥ BID #" (str bids-made) " on request #" (str id) " [reputation recorded]")))
                null)))))

  (log :message "")
  (log :message (concatenate "Total bids: " (str bids-made) " at " (str my-price) " SOL each"))

  {:agent agent-name :price my-price :bids bids-made :strategy "aggressive"})
